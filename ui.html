<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Image</title>
  </head>

  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/thomas-lowry/figma-plugin-ds/dist/figma-plugin-ds.css"
  />

  <style>
    body {
      padding: 2em;
    }
    div {
      margin: 0.5em;
    }
    input {
      display: block;
    }

    #button-apply {
      position: fixed;
      bottom: 2em;
      right: 2em;
      z-index: 999;
    }

    .row {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 10px;
    }

    .gap-5 {
      gap: 5px;
    }

    .column {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .justify-center {
      justify-content: center;
    }

    .align-center {
      align-items: center;
    }

    .align-self-center {
      align-self: center;
    }

    .color-picker {
      min-width: 120px;
    }

    .input-field {
      border: solid 1px #ddd;
      border-radius: 40px;
    }

    .input-color-container {
      position: relative;
      overflow: hidden;
      width: 100px;
      height: 100px;
      border: solid 2px #ddd;
      border-radius: 100px;
    }

    .input-color {
      position: absolute;
      right: -8px;
      top: -8px;
      width: 116px;
      height: 116px;
      border: none;
    }

    .input-color-label {
      cursor: pointer;
      text-decoration: underline;
      color: #aaa;
      font-size: smaller;
    }

    .view-tint-container {
      position: relative;
      overflow: hidden;
      width: 40px;
      height: 40px;
      border: solid 2px #ddd;
      border-radius: 40px;
    }

    .view-color {
      position: absolute;
      right: -8px;
      top: -8px;
      width: 56px;
      height: 56px;
      border: none;
    }

    .input-tint-label {
      text-decoration: underline;
      color: #aaa;
      font-size: x-small;
      align-self: center;
    }
    .input-tint-name-label {
      font-weight: 600;
      color: #2c2c2c;
      font-size: smaller;
      align-self: center;
    }

    .list {
      padding-inline-start: 10px;
    }

    .list-item {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .icon--disabled {
      filter: invert(0%) sepia(0%) saturate(7500%) hue-rotate(117deg)
        brightness(10%) contrast(10%);
    }
  </style>

  <!--* Logo-->
  <svg
    width="202"
    height="48"
    viewBox="0 0 202 48"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <rect width="202" height="48" fill="white" />

    <path
      d="M23.9569 3.02535L20.9315 3.36474L20.5921 0.339387L23.6175 0L23.9569 3.02535Z"
      fill="#86E8DA"
    />
    <path
      d="M28.8737 3.70599L25.852 3.33473L26.2233 0.31312L29.2449 0.684379L28.8737 3.70599Z"
      fill="#86E8DA"
    />
    <path
      d="M33.4803 5.54973L30.6306 4.47875L31.7015 1.62902L34.5513 2.70001L33.4803 5.54973Z"
      fill="#86E8DA"
    />
    <path
      d="M37.5048 8.44595L34.9928 6.72604L36.7127 4.2141L39.2247 5.93402L37.5048 8.44595Z"
      fill="#86E8DA"
    />
    <path
      d="M40.7109 12.2211L38.6906 9.94367L40.968 7.92341L42.9883 10.2008L40.7109 12.2211Z"
      fill="#86E8DA"
    />
    <path
      d="M42.9127 16.6496L41.515 13.9451L44.2195 12.5474L45.6172 15.2519L42.9127 16.6496Z"
      fill="#86CECF"
    />
    <path
      d="M43.9858 21.4689L43.3073 18.5011L46.275 17.8227L46.9535 20.7904L43.9858 21.4689Z"
      fill="#86CECF"
    />
    <path
      d="M43.8734 26.3958L43.9663 23.3529L47.0092 23.4457L46.9163 26.4886L43.8734 26.3958Z"
      fill="#86CECF"
    />
    <path
      d="M42.589 31.1441L43.4536 28.2251L46.3726 29.0896L45.508 32.0086L42.589 31.1441Z"
      fill="#86CECF"
    />
    <path
      d="M40.2132 35.4415L41.7953 32.8406L44.3962 34.4227L42.8141 37.0236L40.2132 35.4415Z"
      fill="#86CECF"
    />
    <path
      d="M36.8872 39.0446L39.0815 36.9344L41.1917 39.1287L38.9974 41.2389L36.8872 39.0446Z"
      fill="#86CECF"
    />
    <path
      d="M32.8041 41.751L35.463 40.2683L36.9456 42.9272L34.2868 44.4098L32.8041 41.751Z"
      fill="#86CECF"
    />
    <path
      d="M28.1973 43.4091L31.1441 42.6447L31.9085 45.5915L28.9617 46.3559L28.1973 43.4091Z"
      fill="#86CECF"
    />
    <path
      d="M23.3286 43.9257L26.3729 43.9195L26.3792 46.9638L23.3348 46.97L23.3286 43.9257Z"
      fill="#86CECF"
    />
    <path
      d="M18.4744 43.2705L21.427 44.0121L20.6854 46.9647L17.7328 46.2231L18.4744 43.2705Z"
      fill="#86CECF"
    />
    <path
      d="M13.9114 41.4781L16.5971 42.9117L15.1635 45.5974L12.4778 44.1638L13.9114 41.4781Z"
      fill="#86CECF"
    />
    <path
      d="M9.90186 38.6477L12.1691 40.6793L10.1374 42.9466L7.87018 40.9149L9.90186 38.6477Z"
      fill="#86CECF"
    />
    <path
      d="M6.67861 34.9378L8.40606 37.4446L5.8993 39.172L4.17185 36.6653L6.67861 34.9378Z"
      fill="#86CECF"
    />
    <path
      d="M4.43129 30.5592L5.53169 33.3977L2.6932 34.4981L1.5928 31.6596L4.43129 30.5592Z"
      fill="#86CECF"
    />
    <path
      d="M3.29468 25.763L3.71629 28.778L0.701299 29.1997L0.279683 26.1847L3.29468 25.763Z"
      fill="#86CECF"
    />
    <path
      d="M3.33977 20.827L3.06641 23.8591L0.0343745 23.5857L0.307743 20.5537L3.33977 20.827Z"
      fill="#86CECF"
    />
    <path
      d="M4.56879 16.0392L3.61864 18.9315L0.726379 17.9813L1.67653 15.0891L4.56879 16.0392Z"
      fill="#86CECF"
    />
    <path
      d="M6.91405 11.6809L5.33781 14.2854L2.73332 12.7092L4.30956 10.1047L6.91405 11.6809Z"
      fill="#86E8DA"
    />
    <path
      d="M10.2414 8.00973L8.11967 10.1929L5.93647 8.07124L8.05816 5.88804L10.2414 8.00973Z"
      fill="#86E8DA"
    />
    <path
      d="M14.3574 5.24388L11.7977 6.89194L10.1497 4.33228L12.7093 2.68423L14.3574 5.24388Z"
      fill="#86E8DA"
    />
    <path
      d="M19.0208 3.54853L16.1538 4.57222L15.1301 1.70516L17.9971 0.681472L19.0208 3.54853Z"
      fill="#86E8DA"
    />
    <path
      d="M44.1428 23.6149C44.1428 34.9639 34.9426 44.1642 23.5936 44.1642C12.2445 44.1642 3.04433 34.9639 3.04433 23.6149C3.04433 12.2659 12.2445 3.0657 23.5936 3.0657C34.9426 3.0657 44.1428 12.2659 44.1428 23.6149Z"
      fill="#86CECF"
    />
    <path
      d="M11.1049 11.349C10.2584 12.2107 9.50016 13.1612 8.84439 14.1871C7.21662 16.7337 6.27592 19.6583 6.11385 22.6762L11.2814 22.9537C11.5163 18.5095 14.1046 14.6892 17.8231 12.7163L15.4025 8.14467C13.8997 8.94036 12.5272 9.94734 11.3242 11.1295C11.2505 11.202 11.1773 11.2752 11.1049 11.349Z"
      fill="#86E8DA"
    />
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      d="M27.6177 6.61958C27.7183 6.64371 27.8186 6.66871 27.9187 6.6946C29.5322 7.11187 31.0842 7.75907 32.5256 8.62173C32.543 8.63215 32.5604 8.6426 32.5778 8.65309L32.576 8.65601C35.1388 10.2139 37.2587 12.4043 38.7319 15.0175C39.3299 16.0781 39.8131 17.1939 40.1767 18.3458C40.2078 18.4444 40.238 18.5433 40.2674 18.6425C40.7407 20.2404 40.9853 21.9041 40.9882 23.5839C40.9883 23.6042 40.9883 23.6244 40.9882 23.6447L35.8154 23.6357C35.8191 19.433 33.6681 15.3605 29.8657 13.0647C29.8596 13.061 29.8535 13.0573 29.8474 13.0536L29.8501 13.0491C26.2579 10.9122 21.6864 10.6717 17.7803 12.7378C17.774 12.7412 17.7677 12.7445 17.7614 12.7479L15.3378 8.17543C15.3557 8.16593 15.3736 8.15644 15.3916 8.14701C18.0483 6.75061 21.0198 6.0606 24.0207 6.14375C25.2378 6.17747 26.4431 6.33791 27.6177 6.61958Z"
      fill="#86CECF"
    />
    <path
      d="M16.3755 4.39306C16.26 4.43649 16.1449 4.48094 16.0302 4.5264C14.6907 5.05739 13.4045 5.72769 12.1937 6.52979C11.5176 6.97767 10.8701 7.46321 10.2541 7.98338C8.15016 9.78052 6.41345 11.995 5.17209 14.4986L10.6164 17.2684C10.6203 17.2608 10.6242 17.2532 10.628 17.2456C13.0222 12.5497 17.6482 9.64808 22.6196 9.26901L22.62 9.27524C22.6285 9.27463 22.637 9.27403 22.6455 9.27344C27.9311 8.90518 32.824 11.4036 35.7036 15.5072L40.6005 12.0773C36.9084 6.64558 30.6823 3.07522 23.6218 3.06572C23.1702 3.06644 22.718 3.08181 22.2658 3.11196L22.2655 3.10793C22.2639 3.10803 22.2623 3.10813 22.2607 3.10823C22.2381 3.10982 22.2156 3.11144 22.193 3.1131C20.1947 3.26012 18.2362 3.69335 16.3755 4.39306Z"
      fill="#86E8DA"
    />
    <path
      d="M46.9436 23.4931C46.9436 36.4563 36.4349 46.9649 23.4718 46.9649C10.5087 46.9649 0 36.4563 0 23.4931C0 10.53 10.5087 0.0213642 23.4718 0.0213642C36.4349 0.0213642 46.9436 10.53 46.9436 23.4931Z"
      fill="url(#paint0_linear_41_130)"
      style="mix-blend-mode: hue"
    />
    <path
      d="M24.2445 11.9446L21.8196 12.1714L21.5928 9.7465L24.0177 9.51967L24.2445 11.9446Z"
      fill="white"
    />
    <path
      d="M30.0455 14.1909L27.8144 13.2143L28.7911 10.9833L31.0221 11.9599L30.0455 14.1909Z"
      fill="white"
    />
    <path
      d="M33.8979 19.0446L32.4769 17.0667L34.4548 15.6457L35.8758 17.6236L33.8979 19.0446Z"
      fill="white"
    />
    <path
      d="M34.7716 25.13L34.6327 22.6985L37.0642 22.5596L37.2031 24.9911L34.7716 25.13Z"
      fill="white"
    />
    <path
      d="M32.5106 30.7816L33.7392 28.6787L35.8421 29.9073L34.6135 32.0102L32.5106 30.7816Z"
      fill="white"
    />
    <path
      d="M27.7876 34.5489L29.9719 33.4718L31.049 35.6561L28.8647 36.7332L27.7876 34.5489Z"
      fill="white"
    />
    <path
      d="M21.833 35.5073L24.2555 35.7585L24.0043 38.1809L21.5818 37.9297L21.833 35.5073Z"
      fill="white"
    />
    <path
      d="M16.1586 33.4002L18.1213 34.8421L16.6794 36.8049L14.7167 35.363L16.1586 33.4002Z"
      fill="white"
    />
    <path
      d="M12.2516 28.7268L13.2786 30.9351L11.0702 31.9621L10.0433 29.7538L12.2516 28.7268Z"
      fill="white"
    />
    <path
      d="M11.1928 22.6855L11.0787 25.1183L8.6459 25.0041L8.76001 22.5714L11.1928 22.6855Z"
      fill="white"
    />
    <path
      d="M13.3225 16.8926L12.1135 19.0068L9.99932 17.7977L11.2084 15.6836L13.3225 16.8926Z"
      fill="white"
    />
    <path
      d="M18.1042 12.9419L16.0642 14.2723L14.7338 12.2323L16.7738 10.9019L18.1042 12.9419Z"
      fill="white"
    />
    <path d="M20.2143 17.6176H27.399V48H20.2143V17.6176Z" fill="#BF8685" />
    <path
      d="M27.399 17.6269V21.6426L24.3078 23.4419L22.5619 20.4425L27.399 17.6269Z"
      fill="#B57473"
    />
    <path
      d="M20.2143 32.9001H22.0409V44.1033H20.2143V32.9001Z"
      fill="#D9B6A9"
    />
    <path
      d="M22.0409 32.5957H24.5982V41.3634H22.0409V32.5957Z"
      fill="#CFAEAA"
    />
    <path d="M22.1018 44.1033H25.9377V48H22.1018V44.1033Z" fill="#C58F84" />
    <path
      d="M20.2143 44.1033H22.1018V46.7214H20.2143V44.1033Z"
      fill="#C3868D"
    />
    <path
      d="M22.1018 44.1033H24.5982V47.0867H22.1018V44.1033Z"
      fill="#D8B185"
    />
    <path
      d="M22.0409 41.1198H24.5982V44.1033H22.0409V41.1198Z"
      fill="#CDA385"
    />
    <path
      d="M24.5982 29.9167H26.0595V36.6142H24.5982V29.9167Z"
      fill="#CFA488"
    />
    <path
      d="M20.2143 29.9167H22.4063V32.9001H20.2143V29.9167Z"
      fill="#CBAFB6"
    />
    <path
      d="M22.4063 29.9167H24.5982V32.9001H22.4063V29.9167Z"
      fill="#C9969C"
    />
    <path
      d="M24.5982 36.6142H26.0595V41.1198H24.5982V36.6142Z"
      fill="#D08791"
    />
    <path
      d="M23.7458 16.3999L27.4105 17.6061L23.7458 18.8353L20.2029 17.6061L23.7458 16.3999Z"
      fill="#BBDDDD"
    />
    <path
      d="M33.8529 28.4554H13.3342L16.9265 25.4111H30.2606L33.8529 28.4554Z"
      fill="#828BAB"
    />
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      d="M16.9265 23.28H30.2606V25.4111H16.9265V23.28Z"
      fill="#74D8E7"
    />
    <path
      d="M33.8529 20.2357V28.4554L30.2606 25.4111V23.28L33.8529 20.2357Z"
      fill="#82A2B7"
    />
    <path
      d="M13.3342 28.4554V20.2357L16.9265 23.28V25.4111L13.3342 28.4554Z"
      fill="#8992B0"
    />
    <path
      d="M13.3342 20.2357H33.8529L30.2606 23.28H16.9265L13.3342 20.2357Z"
      fill="#74D8E7"
    />
    <path d="M25.6333 23.28H24.5373V21.6361H25.6333V23.28Z" fill="#D3E9E9" />
    <path
      d="M30.9304 22.7125L30.2606 23.28H27.399V22.0623H29.1647V22.3059H30.9304V22.7125Z"
      fill="#D3E9E9"
    />
    <path
      d="M20.7014 20.2357V23.28H16.9265L13.3342 20.2357H20.7014Z"
      fill="#D3E9E9"
    />
    <path
      d="M64 30V18H60V16H72V18H68V30H64ZM80 18V16H84V18H80ZM76 30V28H80V22H78V20H84V28H88V30H76ZM90 30V20H102V22H104V30H100V22H94V30H90ZM112 30V22H108V20H112V16H116V20H120V22H116V30H112ZM124 30V28H122V26H126V28H132V24H124V22H122V18H124V16H134V18H136V20H132V18H126V22H134V24H136V28H134V30H124ZM138 30V20H150V22H152V30H148V22H146V30H142V22H140V30H138ZM160 18V16H164V18H160ZM156 30V28H160V22H158V20H164V28H168V30H156ZM176 30V22H172V20H176V16H180V20H184V22H180V30H176ZM186 30V16H190V20H198V22H200V30H196V22H190V30H186Z"
      fill="url(#paint1_linear_41_130)"
    />

    <defs>
      <linearGradient
        id="paint0_linear_41_130"
        x1="48.7546"
        y1="22.5381"
        x2="5.00107"
        y2="36.1034"
        gradientUnits="userSpaceOnUse"
      >
        <stop offset="0.155" stop-color="#3D83ED" />
        <stop offset="0.72" stop-color="#48EAA6" />
        <stop offset="1" stop-color="#2DCCC2" />
      </linearGradient>
      <linearGradient
        id="paint1_linear_41_130"
        x1="207.347"
        y1="23.5127"
        x2="191.234"
        y2="69.4202"
        gradientUnits="userSpaceOnUse"
      >
        <stop offset="0.155" stop-color="#3D83ED" />
        <stop offset="0.72" stop-color="#48EAA6" />
        <stop offset="1" stop-color="#2DCCC2" />
      </linearGradient>
    </defs>
  </svg>

  <div class="row">
    <div class="column">
      <!--*List-->
      <ul id="colors" class="list"></ul>

      <!-- * Add color -->
      <div class="column">
        <button
          id="add-colors"
          class="button button--secondary align-self-center"
        >
          <i class="icon icon--plus"></i>
          Add color
        </button>
      </div>
    </div>

    <!--* Options-->
    <div class="column">
      <!--<button class="button button--tertiary">Label</button>-->

      <div class="checkbox">
        <input id="include_constrast" type="checkbox" class="checkbox__box" />
        <label for="include_constrast" class="checkbox__label"
          >Include constrast values</label
        >
      </div>

      <button id="button-apply" class="button button--primary">
        Apply styles
      </button>
    </div>
  </div>

  <!-- Disclosure -->
  <!--<ul class="disclosure">
    <li class="disclosure__item disclosure--expanded">
      <div class="disclosure__label disclosure--section">
        Disclosure heading
      </div>
      <div class="disclosure__content">Panel content here</div>
    </li>

    <li class="disclosure__item disclosure--expanded">
      <div class="disclosure__label">Disclosure heading</div>
      <div class="disclosure__content">Panel content here</div>
    </li>

    <li class="disclosure__item">
      <div class="disclosure__label">Disclosure heading</div>
      <div class="disclosure__content">Panel content here</div>
    </li>
  </ul>-->

  <!-- Select menu, default behavior is for the initial item to get selected -->


<!-- Select menu, provide an initial item with no value to have no items selected -->
<select id="uniqueId" class="select-menu">
  <option>Please make a selection</option>
  <option value="2" >Item 2</option>
  <option value="3" >Item 3</option>
</select>

  <script>
      //selectMenu.init();
    ////initialize all disclosure panels
    //disclosure.init();

    ////uninitialize all disclosure panels
    //disclosure.destroy();
    createTintSelector();

    const hexToRgb = (hex) => {
      const bigint = parseInt(hex.slice(1), 16);
      const r = (bigint >> 16) & 255;
      const g = (bigint >> 8) & 255;
      const b = bigint & 255;
      return `rgb(${r}, ${g}, ${b})`;
    };

    onmessage = (event) => {
      const message = JSON.parse(event.data.pluginMessage);
      switch (message.type) {
        case 'connect-tints':
          const pickers = document
            .getElementById('colors')
            .querySelectorAll('[itemprop=picker]').length;

          const colorPicker = document.getElementById(`color-input-${pickers}`);
          const colorName = document.getElementById(`colorName-${pickers}`);

          colorPicker.addEventListener(
            'change',
            fetchColor(colorPicker, colorName),
          );

          colorPicker.addEventListener('input', () => {
            colorName.disabled = true;
            const hex = colorPicker.value;
            colorPicker.on;

            for (let i = -6, j = 1; i < 3; i++, j = i + 7) {
              const picker = document.querySelector(
                `#color-container-${pickers} ul li div #tint-${j}00`,
              );
              const colorRgb = hexToRgb(hex);
              const tintHex = generateTint(colorRgb, i);
              picker.value = tintHex;

              const tint = document.querySelector(
                `#color-container-${pickers} ul li label.input-tint-label.tint-${j}00`,
              );
              tint.textContent = tintHex;
            }
          });

        default:
          break;
      }
    };

    document.getElementById('add-colors').onclick = () => createTintSelector();

    document.getElementById('button-apply').onclick = () => {
      //const colorName = parseInt(textbox.value, 10);

      //const pluginForm = document.querySelector('#pluginForm');

      //const pluginFormData = new FormData(pluginForm);

      //const formDataObj = {};

      //for (let [key, value] of pluginFormData) {
      //  formDataObj[key] = value;
      //}

      //console.log(formDataObj)

      parent.postMessage(
        {
          pluginMessage: {
            type: 'create-circles',
            color: {
              rgb: colorRgb.textContent,
              hex: colorHex.textContent,
              colorTitle: colorName.value,
            },
          },
        },
        '*',
      );
    };

    //parent.postMessage(
    //  {
    //    pluginMessage: {
    //      type: 'add-circles',
    //      color: {
    //        rgb: colorRgb.textContent,
    //        hex: colorHex.textContent,
    //        colorTitle: colorName.value,
    //      },
    //    },
    //  },
    //  '*',
    //);

    //document.getElementById('colorHex').onclick = async () => {
    //  const hexValue = document.getElementById('colorPicker');
    //  hexValue.select();

    //  console.log(navigator)

    //  await navigator.clipboard.writeText(hexValue.value)
    //    //alert("Copied the text: " + hexValue.value);

    //  //hexValue.select()
    //};

    //document.getElementById('remove-button-2').onclick = () => {
    //  const colorContainer = document.getElementById('picker-container-2');

    //  console.log(colorContainer)

    //  colorContainer.remove()
    //  //document.removeChild(colorContainer);
    //  //parent.postMessage({ pluginMessage: { type: 'cancel' } }, '*');
    //};

    const debounce = (func, wait, immediate) => {
      let timeout;

      return function () {
        const context = this,
          args = arguments;
        const later = function () {
          timeout = null;
          if (!immediate) func.apply(context, args);
        };

        const callNow = immediate && !timeout;
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
        if (callNow) func.apply(context, args);
      };
    };

    const fetchColor = (colorPicker, colorNameElement) =>
      debounce(() => {
        const hex = colorPicker.value.replace('#', '');
        fetch(`https://www.thecolorapi.com/id?hex=${hex}&format=json`, {
          method: 'GET',
        })
          .then((response) => response.json())
          .then((response) => {
            colorNameElement.value = response.name.value;
            console.log(response.name.value);
            colorNameElement.disabled = false;
          });
      }, 500);

    function createTintSelector() {
      let rgb = randomColor();
      const { r, g, b } = rgbToObject(rgb);
      let hex = rgbToHex(r, g, b);

      const colorsContainer = document.getElementById('colors');
      const colorNumber =
        colorsContainer.querySelectorAll('[itemprop=picker]').length + 1 || 1;

      const colorItem = document.createElement('div');
      colorItem.setAttribute('itemscope', '');
      colorItem.className = 'row';
      colorItem.id = `picker-container-${colorNumber}`;

      const colorForm = document.createElement('form');
      colorForm.setAttribute('itemprop', 'picker');
      colorForm.className = 'color-picker column align-center';
      colorForm.id = `color-picker-${colorNumber}`;

      const fieldset = document.createElement('fieldset');
      fieldset.className = 'input-color-container';

      const colorInput = document.createElement('input');
      colorInput.type = 'color';
      colorInput.value = hex;
      colorInput.className = 'input-color';
      colorInput.id = `color-input-${colorNumber}`;

      const colorLabel = document.createElement('label');
      colorLabel.textContent = hex;
      colorLabel.className = 'input-color-label';
      colorLabel.htmlFor = 'input-color';

      const tintList = document.createElement('ul');
      tintList.className = 'list row';

      //* Input color name
      const colorContainer = document.createElement('div');
      colorContainer.id = `color-container-${colorNumber}`;
      colorContainer.className = 'column';

      const colorNameInput = document.createElement('input');
      colorNameInput.id = `colorName-${colorNumber}`;
      colorNameInput.className = 'input__field input-field';
      colorNameInput.type = 'input';
      colorNameInput.placeholder = 'name';

      const colorName = fetch(
        `https://www.thecolorapi.com/id?hex=${hex.replace(
          '#',
          '',
        )}&format=json`,
        { method: 'GET' },
      )
        .then((response) => {
          return response.json();
        })
        .then((response) => {
          colorNameInput.value = response.name.value;
        });

      const colorNameInputContainer = document.createElement('div');
      colorNameInputContainer.className = 'input';

      const colorButton = document.createElement('button');
      colorButton.id = `remove-button-${colorNumber}`;
      colorButton.className = 'icon-button';
      colorButton.disabled = colorNumber < 1;

      const colorIcon = document.createElement('i');
      colorIcon.className = `icon icon--trash ${
        colorNumber === 1 ? 'icon--disabled' : ''
      }`;

      const colorNameContainer = document.createElement('div');
      colorNameContainer.id = 'color-name-container';
      colorNameContainer.className = 'row';

      colorForm.appendChild(fieldset);
      colorForm.appendChild(colorLabel);
      fieldset.appendChild(colorInput);

      colorItem.appendChild(colorForm);

      colorButton.appendChild(colorIcon);

      colorNameContainer.appendChild(colorNameInputContainer);
      colorNameInputContainer.appendChild(colorNameInput);
      colorNameContainer.appendChild(colorButton);

      //* Generate tints
      for (let i = -6, j = 1; i < 3; i++, j = i + 7) {
        const tintItem = document.createElement('li');
        const tintLabelContent = `${j}00`;
        tintItem.className = 'list-item';

        const tintHex = generateTint(rgb, i);
        const tintCircle = document.createElement('div');
        tintCircle.className = 'view-tint-container';

        const tint = document.createElement('input');
        tint.id = `tint-${tintLabelContent}`;
        tint.className = 'input-color';
        tint.type = 'color';
        tint.value = tintHex;
        tint.disabled = true;

        const tintLabel = document.createElement('label');
        tintLabel.className = 'input-tint-name-label';
        tintLabel.textContent = tintLabelContent;

        const hexLabel = document.createElement('label');
        hexLabel.className = `input-tint-label tint-${tintLabelContent}`;
        hexLabel.textContent = tintHex;

        tintCircle.appendChild(tint);
        tintItem.appendChild(tintCircle);
        tintItem.appendChild(tintLabel);
        tintItem.appendChild(hexLabel);

        tintList.appendChild(tintItem);
      }

      colorContainer.appendChild(colorNameContainer);
      colorContainer.appendChild(tintList);

      colorItem.appendChild(colorContainer);

      colorsContainer.appendChild(colorItem);

      if (colorNumber > 1) {
        document.getElementById(`remove-button-${colorNumber}`).onclick =
          () => {
            const colorContainer = document.getElementById(
              `picker-container-${colorNumber}`,
            );
            colorContainer.remove();
          };
      }

      //const event = new MessageEvent('message');
      //dispatchEvent(event);

      parent.postMessage(
        {
          pluginMessage: {
            type: 'add-circles-ui',
            color: {
              rgb: rgb,
              hex: hex,
              colorTitle: colorNameInput.value,
            },
          },
        },
        '*',
      );
    }

    function randomColor() {
      return `rgb(${getRandom(0, 220)},${getRandom(0, 220)},${getRandom(
        0,
        220,
      )})`;
    }

    function getRandom(min, max) {
      return Math.random() * (max - min) + min;
    }

    function calculateTints() {
      for (let i = -7, j = 1; i < 3; i++, j = i + 7) {
        document.getElementById(`color-${j}00`).value = generateTint(
          colorRgb.textContent,
          i,
        );
      }
    }

    function rgbToObject(rgb, noClamp = false) {
      const rgbArray = rgb.split('(')[1].split(',');
      const r = Math.round(rgbArray[0]);
      const g = Math.round(rgbArray[1]);
      const b = Math.round(rgbArray[2].slice(0, -1));

      if (noClamp) {
        return { r, g, b };
      }

      return { r: r / 255, g: g / 255, b: b / 255 };
    }

    function generateTint(rgb, level) {
      const { r, g, b } = rgbToObject(rgb);

      const step_lightness = 0.5 / 11;

      const { h, l, s } = rgbToHls(r, g, b);
      // * Create tints
      let lightness = l - level * step_lightness;
      lightness = Math.max(0, Math.min(1, lightness));

      const { r: _r, g: _g, b: _b } = hlsToRgb(h, lightness, s);

      // * Return the lightness tint
      return rgbToHex(_r, _g, _b);
    }

    function rgbToHls(r, g, b) {
      const maxc = Math.max(r, g, b);
      const minc = Math.min(r, g, b);
      const sumc = maxc + minc;
      const rangec = maxc - minc;
      const l = sumc / 2.0;
      let s;
      if (minc == maxc) {
        return { h: 0.0, l, s: 0.0 };
      }
      if (l <= 0.5) {
        s = rangec / sumc;
      } else {
        s = rangec / (2.0 - sumc);
      }
      const rc = (maxc - r) / rangec;
      const gc = (maxc - g) / rangec;
      const bc = (maxc - b) / rangec;

      let h;
      if (r == maxc) {
        h = bc - gc;
      } else if (g == maxc) {
        h = 2.0 + rc - bc;
      } else {
        h = 4.0 + gc - rc;
      }
      h = (h / 6.0) % 1.0;
      return { h, l, s };
    }

    function hlsToRgb(h, l, s) {
      let r, g, b;

      if (s === 0) {
        r = g = b = l; // achromatic
      } else {
        const hue2rgb = (p, q, t) => {
          if (t < 0) t += 1;
          if (t > 1) t -= 1;
          if (t < 1 / 6) return p + (q - p) * 6 * t;
          if (t < 1 / 2) return q;
          if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;
          return p;
        };

        const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
        const p = 2 * l - q;

        r = hue2rgb(p, q, h + 1 / 3);
        g = hue2rgb(p, q, h);
        b = hue2rgb(p, q, h - 1 / 3);
      }

      return { r, g, b };
    }

    function rgbToHex(r, g, b) {
      return `#${(
        (1 << 24) +
        (Math.round(r * 255) << 16) +
        (Math.round(g * 255) << 8) +
        Math.round(b * 255)
      )
        .toString(16)
        .slice(1)}`;
    }
  </script>
</html>
